{"version":3,"sources":["../../node_modules/tslib/tslib.es6.js","../../src/app/components/tree/tree.ts"],"names":["Object","create","__values","o","s","Symbol","iterator","m","i","call","length","next","value","done","TypeError","__read","n","r","e","ar","push","error","__spread","arguments","concat","UITreeNode","tree","this","prototype","ngOnInit","node","parent","parentNode","syncNodeOption","getNodeWithKey","key","getIcon","icon","expanded","children","expandedIcon","collapsedIcon","ICON_CLASS","isLeaf","isNodeLeaf","toggle","event","collapse","expand","virtualScroll","updateSerializedValue","onNodeExpand","emit","originalEvent","onNodeCollapse","onNodeClick","onNodeKeydown","which","onNodeTouchEnd","onNodeRightClick","isSelected","onDropPoint","position","_this","preventDefault","dragNode","dragNodeIndex","dragNodeScope","isValidDropPointIndex","dragNodeTree","index","allowDrop","DropType","DropPoint","dropParams_1","assign","createDropPointEventMetadata","validateDrop","onNodeDrop","dropNode","dropIndex","accept","processPointDrop","draghoverPrev","draghoverNext","newNodeList","dragNodeSubNodes","splice","dragDropService","stopDrag","subNodes","onDropPointDragOver","dataTransfer","dropEffect","onDropPointDragEnter","onDropPointDragLeave","onDragStart","draggableNodes","draggable","setData","startDrag","scope","draggableScope","onDragStop","onDropNodeDragOver","droppableNodes","stopPropagation","onDropNode","droppable","Node","dropParams_2","createDropNodeEventMetadata","processNodeDrop","draghoverNode","onDropNodeDragEnter","onDropNodeDragLeave","rect","currentTarget","getBoundingClientRect","x","left","width","y","Math","floor","top","height","onKeyDown","nodeElement","target","parentElement","nodeName","listElement","focusNode","nextNodeElement","nextElementSibling","nextSiblingAncestor","findNextSiblingOfAncestor","previousElementSibling","findLastVisibleDescendant","parentNodeElement","getParentNodeElement","childrenListElement","Array","from","find","el","DomHandler","hasClass","lastChildElement","tagName","element","focus","Component","args","selector","template","encapsulation","ViewEncapsulation","None","Inject","forwardRef","Tree","Input","selectionChange","EventEmitter","onNodeSelect","onNodeUnselect","onNodeContextMenuSelect","layout","metaKeySelection","propagateSelectionUp","propagateSelectionDown","loadingIcon","emptyMessage","filterBy","filterMode","trackBy","item","onFilter","dragStartSubscription","dragStart$","subscribe","dragStopSubscription","dragStop$","dragHover","ngOnChanges","simpleChange","defineProperty","ngAfterContentInit","templates","templateMap","forEach","name","serializedValue","serializeNodes","getRootNode","nodes","level","visible","nodes_1","nodes_1_1","rowNode","eventTarget","selectionMode","selectable","hasFilteredNodes","index_1","findIndexInSelection","selected","isCheckboxSelectionMode","propagateDown","selection","filter","val","propagateUp","nodeTouched","metaKey","ctrlKey","isSingleSelectionMode","isMultipleSelectionMode","contextMenu","className","indexOf","show","selectedNode","parentNodes","option","_node","filteredNodes","nodes_2","nodes_2_1","matchedNode","select","selectedCount","childPartialSelected","_b","_c","child","partialSelected","index_2","leaf","getTemplateForNode","type","onDragOver","onDrop","Both","onDragEnter","onDragLeave","dropType","isValidDragScope","allow_1","evaluateDropScope","dropScope","dragScope","dropScope_1","dropScope_1_1","dragScope_1","e_6","dragScope_1_1","dropPointScope","droppableScope","dropScope_2","dropScope_2_1","dragScope_2","e_8","dragScope_2_1","_filter","filterValue","searchFields","split","filterText","ObjectUtils","removeAccents","toLocaleLowerCase","filterLocale","isStrictMode","copyNode","paramsWithoutNode","findFilteredNodes","isFilterMatched","filteredValue","matched","childNodes","childNodes_1","childNodes_1_1","childNode","copyChildNode","_a","searchFields_1","searchFields_1_1","field","String","resolveFieldData","getBlockableElement","nativeElement","ngOnDestroy","unsubscribe","changeDetection","ChangeDetectionStrategy","Default","ElementRef","TreeDragDropService","decorators","Optional","Output","ContentChildren","PrimeTemplate","NgModule","imports","CommonModule","ScrollingModule","RippleModule","exports","SharedModule","declarations"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","import {NgModule,Component,Input,AfterContentInit,OnDestroy,Output,EventEmitter,OnInit,OnChanges,\n    ContentChildren,QueryList,TemplateRef,Inject,ElementRef,forwardRef,ChangeDetectionStrategy,SimpleChanges, ViewEncapsulation} from '@angular/core';\nimport {ScrollingModule} from '@angular/cdk/scrolling';\nimport {Optional} from '@angular/core';\nimport {CommonModule} from '@angular/common';\nimport {Subscription, Subject}   from 'rxjs';\nimport { first } from 'rxjs/operators';\nimport {TreeNode} from 'primeng/api';\nimport {SharedModule} from 'primeng/api';\nimport {PrimeTemplate} from 'primeng/api';\nimport {TreeDragDropService} from 'primeng/api';\nimport {BlockableUI} from 'primeng/api';\nimport {ObjectUtils} from 'primeng/utils';\nimport { DomHandler } from 'primeng/dom';\nimport {RippleModule} from 'primeng/ripple';\n\n@Component({\n    selector: 'p-treeNode',\n    template: `\n        <ng-template [ngIf]=\"node\">\n            <li *ngIf=\"tree.droppableNodes\" class=\"p-treenode-droppoint\" [ngClass]=\"{'p-treenode-droppoint-active':draghoverPrev}\"\n            (drop)=\"onDropPoint($event,-1)\" (dragover)=\"onDropPointDragOver($event)\" (dragenter)=\"onDropPointDragEnter($event,-1)\" (dragleave)=\"onDropPointDragLeave($event)\"></li>\n            <li *ngIf=\"!tree.horizontal\" role=\"treeitem\" [ngClass]=\"['p-treenode',node.styleClass||'', isLeaf() ? 'p-treenode-leaf': '']\">\n                <div class=\"p-treenode-content\" (click)=\"onNodeClick($event)\" (contextmenu)=\"onNodeRightClick($event)\" (touchend)=\"onNodeTouchEnd()\"\n                    (drop)=\"onDropNode($event)\" (dragover)=\"onDropNodeDragOver($event)\" (dragenter)=\"onDropNodeDragEnter($event)\" (dragleave)=\"onDropNodeDragLeave($event)\"\n                    [draggable]=\"tree.draggableNodes\" (dragstart)=\"onDragStart($event)\" (dragend)=\"onDragStop($event)\" [attr.tabindex]=\"0\"\n                    [ngClass]=\"{'p-treenode-selectable':tree.selectionMode && node.selectable !== false,'p-treenode-dragover':draghoverNode, 'p-highlight':isSelected()}\"\n                    (keydown)=\"onKeyDown($event)\" [attr.aria-posinset]=\"this.index + 1\" [attr.aria-expanded]=\"this.node.expanded\" [attr.aria-selected]=\"isSelected()\" [attr.aria-label]=\"node.label\">\n                    <button type=\"button\" class=\"p-tree-toggler p-link\" (click)=\"toggle($event)\" pRipple>\n                        <span class=\"p-tree-toggler-icon pi pi-fw\" [ngClass]=\"{'pi-chevron-right':!node.expanded,'pi-chevron-down':node.expanded}\"></span>\n                    </button>\n                    <div class=\"p-checkbox p-component\" *ngIf=\"tree.selectionMode == 'checkbox'\" [attr.aria-checked]=\"isSelected()\">\n                        <div class=\"p-checkbox-box\" [ngClass]=\"{'p-highlight': isSelected(), 'p-indeterminate': node.partialSelected}\">\n                            <span class=\"p-checkbox-icon pi\" [ngClass]=\"{'pi-check':isSelected(),'pi-minus':node.partialSelected}\"></span>\n                        </div>\n                    </div>\n                    <span [class]=\"getIcon()\" *ngIf=\"node.icon||node.expandedIcon||node.collapsedIcon\"></span>\n                    <span class=\"p-treenode-label\">\n                            <span *ngIf=\"!tree.getTemplateForNode(node)\">{{node.label}}</span>\n                            <span *ngIf=\"tree.getTemplateForNode(node)\">\n                                <ng-container *ngTemplateOutlet=\"tree.getTemplateForNode(node); context: {$implicit: node}\"></ng-container>\n                            </span>\n                    </span>\n                </div>\n                <ul class=\"p-treenode-children\" style=\"display: none;\" *ngIf=\"!tree.virtualScroll && node.children && node.expanded\" [style.display]=\"node.expanded ? 'block' : 'none'\" role=\"group\">\n                    <p-treeNode *ngFor=\"let childNode of node.children;let firstChild=first;let lastChild=last; let index=index; trackBy: tree.trackBy\" [node]=\"childNode\" [parentNode]=\"node\"\n                        [firstChild]=\"firstChild\" [lastChild]=\"lastChild\" [index]=\"index\" [style.height.px]=\"tree.virtualNodeHeight\" [level]=\"level + 1\"></p-treeNode>\n                </ul>\n            </li>\n            <li *ngIf=\"tree.droppableNodes&&lastChild\" class=\"p-treenode-droppoint\" [ngClass]=\"{'p-treenode-droppoint-active':draghoverNext}\"\n            (drop)=\"onDropPoint($event,1)\" (dragover)=\"onDropPointDragOver($event)\" (dragenter)=\"onDropPointDragEnter($event,1)\" (dragleave)=\"onDropPointDragLeave($event)\"></li>\n            <table *ngIf=\"tree.horizontal\" [class]=\"node.styleClass\">\n                <tbody>\n                    <tr>\n                        <td class=\"p-treenode-connector\" *ngIf=\"!root\">\n                            <table class=\"p-treenode-connector-table\">\n                                <tbody>\n                                    <tr>\n                                        <td [ngClass]=\"{'p-treenode-connector-line':!firstChild}\"></td>\n                                    </tr>\n                                    <tr>\n                                        <td [ngClass]=\"{'p-treenode-connector-line':!lastChild}\"></td>\n                                    </tr>\n                                </tbody>\n                            </table>\n                        </td>\n                        <td class=\"p-treenode\" [ngClass]=\"{'p-treenode-collapsed':!node.expanded}\">\n                            <div class=\"p-treenode-content\" tabindex=\"0\" [ngClass]=\"{'p-treenode-selectable':tree.selectionMode,'p-highlight':isSelected()}\" (click)=\"onNodeClick($event)\" (contextmenu)=\"onNodeRightClick($event)\"\n                                (touchend)=\"onNodeTouchEnd()\" (keydown)=\"onNodeKeydown($event)\">\n                                <span class=\"p-tree-toggler pi pi-fw\" [ngClass]=\"{'pi-plus':!node.expanded,'pi-minus':node.expanded}\" *ngIf=\"!isLeaf()\" (click)=\"toggle($event)\"></span>\n                                <span [class]=\"getIcon()\" *ngIf=\"node.icon||node.expandedIcon||node.collapsedIcon\"></span>\n                                <span class=\"p-treenode-label\">\n                                    <span *ngIf=\"!tree.getTemplateForNode(node)\">{{node.label}}</span>\n                                    <span *ngIf=\"tree.getTemplateForNode(node)\">\n                                        <ng-container *ngTemplateOutlet=\"tree.getTemplateForNode(node); context: {$implicit: node}\"></ng-container>\n                                    </span>\n                                </span>\n                            </div>\n                        </td>\n                        <td class=\"p-treenode-children-container\" *ngIf=\"node.children && node.expanded\" [style.display]=\"node.expanded ? 'table-cell' : 'none'\">\n                            <div class=\"p-treenode-children\">\n                                <p-treeNode *ngFor=\"let childNode of node.children;let firstChild=first;let lastChild=last; trackBy: tree.trackBy\" [node]=\"childNode\"\n                                        [firstChild]=\"firstChild\" [lastChild]=\"lastChild\"></p-treeNode>\n                            </div>\n                        </td>\n                    </tr>\n                </tbody>\n            </table>\n        </ng-template>\n    `,\n    encapsulation: ViewEncapsulation.None\n})\nexport class UITreeNode implements OnInit {\n\n    static ICON_CLASS: string = 'p-treenode-icon ';\n\n    @Input() rowNode: any;\n\n    @Input() node: TreeNode;\n\n    @Input() parentNode: TreeNode;\n\n    @Input() root: boolean;\n\n    @Input() index: number;\n\n    @Input() firstChild: boolean;\n\n    @Input() lastChild: boolean;\n\n    @Input() level: number;\n\n    tree: Tree;\n\n    constructor(@Inject(forwardRef(() => Tree)) tree) {\n        this.tree = tree as Tree;\n    }\n\n    draghoverPrev: boolean;\n\n    draghoverNext: boolean;\n\n    draghoverNode: boolean\n\n    ngOnInit() {\n        this.node.parent = this.parentNode;\n\n        if (this.parentNode) {\n            this.tree.syncNodeOption(this.node, this.tree.value, 'parent', this.tree.getNodeWithKey(this.parentNode.key, this.tree.value));\n        }\n    }\n\n    getIcon() {\n        let icon: string;\n\n        if (this.node.icon)\n            icon = this.node.icon;\n        else\n            icon = this.node.expanded && this.node.children && this.node.children.length ? this.node.expandedIcon : this.node.collapsedIcon;\n\n        return UITreeNode.ICON_CLASS + ' ' + icon;\n    }\n\n    isLeaf() {\n        return this.tree.isNodeLeaf(this.node);\n    }\n\n    toggle(event: Event) {\n        if (this.node.expanded)\n            this.collapse(event);\n        else\n            this.expand(event);\n    }\n\n    expand(event: Event) {\n        this.node.expanded = true;\n        if (this.tree.virtualScroll) {\n            this.tree.updateSerializedValue();\n        }\n        this.tree.onNodeExpand.emit({originalEvent: event, node: this.node});\n    }\n\n    collapse(event: Event) {\n        this.node.expanded = false;\n        if (this.tree.virtualScroll) {\n            this.tree.updateSerializedValue();\n        }\n        this.tree.onNodeCollapse.emit({originalEvent: event, node: this.node});\n    }\n\n    onNodeClick(event: MouseEvent) {\n        this.tree.onNodeClick(event, this.node);\n    }\n\n    onNodeKeydown(event: KeyboardEvent) {\n        if (event.which === 13) {\n            this.tree.onNodeClick(event, this.node);\n        }\n    }\n\n    onNodeTouchEnd() {\n        this.tree.onNodeTouchEnd();\n    }\n\n    onNodeRightClick(event: MouseEvent) {\n        this.tree.onNodeRightClick(event, this.node);\n    }\n\n    isSelected() {\n        return this.tree.isSelected(this.node);\n    }\n\n    onDropPoint(event: Event, position: number) {\n        event.preventDefault();\n        let dragNode = this.tree.dragNode;\n        let dragNodeIndex = this.tree.dragNodeIndex;\n        let dragNodeScope = this.tree.dragNodeScope;\n        let isValidDropPointIndex = this.tree.dragNodeTree === this.tree ? (position === 1 || dragNodeIndex !== this.index - 1) : true;\n\n        if(this.tree.allowDrop(dragNode, this.node, dragNodeScope, DropType.DropPoint) && isValidDropPointIndex) {\n            let dropParams = {...this.createDropPointEventMetadata(position)};\n\n            if (this.tree.validateDrop) {\n                // let newNodeList = this.node.parent ? this.node.parent.children : this.tree.value;\n                // let dropIndex = this.index;\n                // const resolve = new Subject<boolean>();\n\n                // resolve.pipe(first()).subscribe(proceed => {\n                //     if (proceed !== false) {\n                //         this.tree.dragNodeSubNodes.splice(dragNodeIndex, 1);\n\n                //         if (position < 0) {\n                //             dropIndex = (this.tree.dragNodeSubNodes === newNodeList) ? ((this.tree.dragNodeIndex > this.index) ? this.index : this.index - 1) : this.index;\n                //             newNodeList.splice(dropIndex, 0, dragNode);\n                //         }\n                //         else {\n                //             dropIndex = newNodeList.length;\n                //             newNodeList.push(dragNode);\n                //         }\n                //     }\n\n                //     this.tree.dragDropService.stopDrag({\n                //         node: dragNode,\n                //         subNodes: this.node.parent ? this.node.parent.children : this.tree.value,\n                //         index: dragNodeIndex\n                //     });\n\n                //     let newNodeList = event.dropNode.parent ? event.dropNode.parent.children : this.tree.value;\n                //     event.dragNodeSubNodes.splice(event.dragNodeIndex, 1);\n                //     let dropIndex = this.index;\n\n                //     if (event.position < 0) {\n                //         dropIndex = (event.dragNodeSubNodes === newNodeList) ? ((event.dragNodeIndex > event.index) ? event.index : event.index - 1) : event.index;\n                //         newNodeList.splice(dropIndex, 0, event.dragNode);\n                //     }\n                //     else {\n                //         dropIndex = newNodeList.length;\n                //         newNodeList.push(event.dragNode);\n                //     }\n\n                //     this.tree.dragDropService.stopDrag({\n                //         node: event.dragNode,\n                //         subNodes: event.dropNode.parent ? event.dropNode.parent.children : this.tree.value,\n                //         index: event.dragNodeIndex\n                //     });\n                // });\n\n                // this.tree.onNodeDrop.emit({\n            //     originalEvent: event,\n            //     dragNode: dragNode,\n            //     dropNode: this.node,\n            //     dropIndex: dropIndex,\n            //     proceed: resolve\n            // });\n                \n                this.tree.onNodeDrop.emit({\n                    originalEvent: event,\n                    dragNode: dragNode,\n                    dropNode: this.node,\n                    dropIndex: this.index,\n                    accept: () => {\n                        this.processPointDrop(dropParams);\n                    }\n                });\n            }\n            else {\n                this.processPointDrop(dropParams);\n                this.tree.onNodeDrop.emit({\n                    originalEvent: event,\n                    dragNode: dragNode,\n                    dropNode: this.node,\n                    dropIndex: this.index\n                });\n            }\n        }\n\n        this.draghoverPrev = false;\n        this.draghoverNext = false;\n    }\n\n    processPointDrop(event) {\n        let newNodeList = event.dropNode.parent ? event.dropNode.parent.children : this.tree.value;\n        event.dragNodeSubNodes.splice(event.dragNodeIndex, 1);\n        let dropIndex = this.index;\n\n        if (event.position < 0) {\n            dropIndex = (event.dragNodeSubNodes === newNodeList) ? ((event.dragNodeIndex > event.index) ? event.index : event.index - 1) : event.index;\n            newNodeList.splice(dropIndex, 0, event.dragNode);\n        }\n        else {\n            dropIndex = newNodeList.length;\n            newNodeList.push(event.dragNode);\n        }\n\n        this.tree.dragDropService.stopDrag({\n            node: event.dragNode,\n            subNodes: event.dropNode.parent ? event.dropNode.parent.children : this.tree.value,\n            index: event.dragNodeIndex\n        });\n    }\n\n    createDropPointEventMetadata(position) {\n        return {\n            dragNode: this.tree.dragNode,\n            dragNodeIndex:  this.tree.dragNodeIndex,\n            dragNodeSubNodes: this.tree.dragNodeSubNodes,\n            dropNode: this.node,\n            index: this.index,\n            position: position\n        };\n    }\n\n    onDropPointDragOver(event) {\n        event.dataTransfer.dropEffect = 'move';\n        event.preventDefault();\n    }\n\n    onDropPointDragEnter(event: Event, position: number) {\n        if(this.tree.allowDrop(this.tree.dragNode, this.node, this.tree.dragNodeScope, DropType.DropPoint)) {\n            if(position < 0)\n                this.draghoverPrev = true;\n            else\n                this.draghoverNext = true;\n        }\n    }\n\n    onDropPointDragLeave(event: Event) {\n        this.draghoverPrev = false;\n        this.draghoverNext = false;\n    }\n\n    onDragStart(event) {\n        if (this.tree.draggableNodes && this.node.draggable !== false) {\n            event.dataTransfer.setData(\"text\", \"data\");\n\n            this.tree.dragDropService.startDrag({\n                tree: this,\n                node: this.node,\n                subNodes: this.node.parent ? this.node.parent.children : this.tree.value,\n                index: this.index,\n                scope: this.tree.draggableScope\n            });\n        }\n        else {\n            event.preventDefault();\n        }\n    }\n\n    onDragStop(event) {\n        this.tree.dragDropService.stopDrag({\n            node: this.node,\n            subNodes: this.node.parent ? this.node.parent.children : this.tree.value,\n            index: this.index\n        });\n    }\n\n    onDropNodeDragOver(event) {\n        event.dataTransfer.dropEffect = 'move';\n        if (this.tree.droppableNodes) {\n            event.preventDefault();\n            event.stopPropagation();\n        }\n    }\n\n    onDropNode(event) {\n        if (this.tree.droppableNodes && this.node.droppable !== false) {\n            let dragNode = this.tree.dragNode;\n            \n            if(this.tree.allowDrop(dragNode, this.node, this.tree.dragNodeScope, DropType.Node)) {\n                // let dragNodeIndex = this.tree.dragNodeIndex;\n                // const resolve = new Subject<boolean>();\n\n                // resolve.pipe(first()).subscribe(proceed => {\n                //     if (proceed !== false) {\n                //         this.tree.dragNodeSubNodes.splice(dragNodeIndex, 1);\n\n                //         if (this.node.children)\n                //             this.node.children.push(dragNode);\n                //         else\n                //             this.node.children = [dragNode];\n                //     }\n\n                //     this.tree.dragDropService.stopDrag({\n                //         node: dragNode,\n                //         subNodes: this.node.parent ? this.node.parent.children : this.tree.value,\n                //         index: this.tree.dragNodeIndex\n                //     });\n                // });\n\n                // this.tree.onNodeDrop.emit({\n                //     originalEvent: event,\n                //     dragNode: dragNode,\n                //     dropNode: this.node,\n                //     index: this.index,\n                //     proceed: resolve\n                // });\n\n                let dropParams = {...this.createDropNodeEventMetadata()};\n\n                if (this.tree.validateDrop) {\n                    this.tree.onNodeDrop.emit({\n                        originalEvent: event,\n                        dragNode: dragNode,\n                        dropNode: this.node,\n                        index: this.index,\n                        accept: () => {\n                            this.processNodeDrop(dropParams);\n                        }\n                    });\n                }\n                else {\n                    this.processNodeDrop(dropParams);\n                    this.tree.onNodeDrop.emit({\n                        originalEvent: event,\n                        dragNode: dragNode,\n                        dropNode: this.node,\n                        index: this.index\n                    });\n                }\n            }\n        }\n\n        event.preventDefault();\n        event.stopPropagation();\n        this.draghoverNode = false;\n    }\n\n    createDropNodeEventMetadata() {\n        return {\n            dragNode: this.tree.dragNode,\n            dragNodeIndex:  this.tree.dragNodeIndex,\n            dragNodeSubNodes: this.tree.dragNodeSubNodes,\n            dropNode: this.node\n        };\n    }\n\n    processNodeDrop(event) {\n        let dragNodeIndex = event.dragNodeIndex;\n        event.dragNodeSubNodes.splice(dragNodeIndex, 1);\n\n        if (event.dropNode.children)\n            event.dropNode.children.push(event.dragNode);\n        else\n            event.dropNode.children = [event.dragNode];\n\n        this.tree.dragDropService.stopDrag({\n            node: event.dragNode,\n            subNodes: event.dropNode.parent ? event.dropNode.parent.children : this.tree.value,\n            index: dragNodeIndex\n        });\n    }\n\n    onDropNodeDragEnter(event) {\n        if(this.tree.droppableNodes && this.node.droppable !== false && this.tree.allowDrop(this.tree.dragNode, this.node, this.tree.dragNodeScope, DropType.Node)) {\n            this.draghoverNode = true;\n        }\n    }\n\n    onDropNodeDragLeave(event) {\n        if (this.tree.droppableNodes) {\n            let rect = event.currentTarget.getBoundingClientRect();\n            if (event.x > rect.left + rect.width || event.x < rect.left || event.y >= Math.floor(rect.top + rect.height) || event.y < rect.top) {\n               this.draghoverNode = false;\n            }\n        }\n    }\n\n    onKeyDown(event: KeyboardEvent) {\n        const nodeElement = (<HTMLDivElement> event.target).parentElement.parentElement;\n\n        if (nodeElement.nodeName !== 'P-TREENODE') {\n            return;\n        }\n\n        switch (event.which) {\n            //down arrow\n            case 40:\n                const listElement = (this.tree.droppableNodes) ? nodeElement.children[1].children[1] : nodeElement.children[0].children[1];\n                if (listElement && listElement.children.length > 0) {\n                    this.focusNode(listElement.children[0]);\n                }\n                else {\n                    const nextNodeElement = nodeElement.nextElementSibling;\n                    if (nextNodeElement) {\n                        this.focusNode(nextNodeElement);\n                    }\n                    else {\n                        let nextSiblingAncestor = this.findNextSiblingOfAncestor(nodeElement);\n                        if (nextSiblingAncestor) {\n                            this.focusNode(nextSiblingAncestor);\n                        }\n                    }\n                }\n\n                event.preventDefault();\n            break;\n\n            //up arrow\n            case 38:\n                if (nodeElement.previousElementSibling) {\n                    this.focusNode(this.findLastVisibleDescendant(nodeElement.previousElementSibling));\n                }\n                else {\n                    let parentNodeElement = this.getParentNodeElement(nodeElement);\n                    if (parentNodeElement) {\n                        this.focusNode(parentNodeElement);\n                    }\n                }\n\n                event.preventDefault();\n            break;\n\n            //right arrow\n            case 39:\n                if (!this.node.expanded && !this.tree.isNodeLeaf(this.node)) {\n                    this.expand(event);\n                }\n\n                event.preventDefault();\n            break;\n\n            //left arrow\n            case 37:\n                if (this.node.expanded) {\n                    this.collapse(event);\n                }\n                else {\n                    let parentNodeElement = this.getParentNodeElement(nodeElement);\n                    if (parentNodeElement) {\n                        this.focusNode(parentNodeElement);\n                    }\n                }\n\n                event.preventDefault();\n            break;\n\n            //enter\n            case 13:\n                this.tree.onNodeClick(event, this.node);\n                event.preventDefault();\n            break;\n\n            default:\n                //no op\n            break;\n        }\n    }\n\n    findNextSiblingOfAncestor(nodeElement) {\n        let parentNodeElement = this.getParentNodeElement(nodeElement);\n        if (parentNodeElement) {\n            if (parentNodeElement.nextElementSibling)\n                return parentNodeElement.nextElementSibling;\n            else\n                return this.findNextSiblingOfAncestor(parentNodeElement);\n        }\n        else {\n            return null;\n        }\n    }\n\n    findLastVisibleDescendant(nodeElement) {\n        const listElement = <HTMLElement> Array.from(nodeElement.children).find(el => DomHandler.hasClass(el, 'p-treenode'));\n        const childrenListElement = listElement.children[1];\n        if (childrenListElement && childrenListElement.children.length > 0) {\n            const lastChildElement = childrenListElement.children[childrenListElement.children.length - 1];\n\n            return this.findLastVisibleDescendant(lastChildElement);\n        }\n        else {\n            return nodeElement;\n        }\n    }\n\n    getParentNodeElement(nodeElement) {\n        const parentNodeElement = nodeElement.parentElement.parentElement.parentElement;\n\n        return parentNodeElement.tagName === 'P-TREENODE' ? parentNodeElement : null;\n    }\n\n    focusNode(element) {\n        if (this.tree.droppableNodes)\n            element.children[1].children[0].focus();\n        else\n            element.children[0].children[0].focus();\n    }\n}\n\n@Component({\n    selector: 'p-tree',\n    template: `\n        <div [ngClass]=\"{'p-tree p-component':true,'p-tree-selectable':selectionMode,\n                'p-treenode-dragover':dragHover,'p-tree-loading': loading, 'p-tree-flex-scrollable': scrollHeight === 'flex'}\" \n            [ngStyle]=\"style\" [class]=\"styleClass\" *ngIf=\"!horizontal\"\n            (drop)=\"onDrop($event)\" (dragover)=\"onDragOver($event)\" (dragenter)=\"onDragEnter($event)\" (dragleave)=\"onDragLeave($event)\">\n            <div class=\"p-tree-loading-overlay p-component-overlay\" *ngIf=\"loading\">\n                <i [class]=\"'p-tree-loading-icon pi-spin ' + loadingIcon\"></i>\n            </div>\n            <div *ngIf=\"filter\" class=\"p-tree-filter-container\">\n                <input #filter type=\"text\" autocomplete=\"off\" class=\"p-tree-filter p-inputtext p-component\" [attr.placeholder]=\"filterPlaceholder\"\n                    (keydown.enter)=\"$event.preventDefault()\" (input)=\"_filter($event)\">\n                    <span class=\"p-tree-filter-icon pi pi-search\"></span>\n            </div>\n            <ng-container *ngIf=\"!virtualScroll; else virtualScrollList\">\n                <div class=\"p-tree-wrapper\" [style.max-height]=\"scrollHeight\">\n                    <ul class=\"p-tree-container\" *ngIf=\"getRootNode()\" role=\"tree\" [attr.aria-label]=\"ariaLabel\" [attr.aria-labelledby]=\"ariaLabelledBy\">\n                        <p-treeNode *ngFor=\"let node of getRootNode(); let firstChild=first;let lastChild=last; let index=index; trackBy: trackBy\" [node]=\"node\"\n                                    [firstChild]=\"firstChild\" [lastChild]=\"lastChild\" [index]=\"index\" [level]=\"0\"></p-treeNode>\n                    </ul>\n                </div>\n            </ng-container>\n            <ng-template #virtualScrollList>\n                <cdk-virtual-scroll-viewport class=\"p-tree-wrapper\" [style.height]=\"scrollHeight\" [itemSize]=\"virtualNodeHeight\" [minBufferPx]=\"minBufferPx\" [maxBufferPx]=\"maxBufferPx\">\n                    <ul class=\"p-tree-container\" *ngIf=\"getRootNode()\" role=\"tree\" [attr.aria-label]=\"ariaLabel\" [attr.aria-labelledby]=\"ariaLabelledBy\">\n                        <p-treeNode *cdkVirtualFor=\"let rowNode of serializedValue; let firstChild=first; let lastChild=last; let index=index; trackBy: trackBy; templateCacheSize: 0\"  [level]=\"rowNode.level\"\n                                    [rowNode]=\"rowNode\" [node]=\"rowNode.node\" [firstChild]=\"firstChild\" [lastChild]=\"lastChild\" [index]=\"index\" [style.height.px]=\"virtualNodeHeight\"></p-treeNode>\n                    </ul>\n                </cdk-virtual-scroll-viewport>\n            </ng-template>\n            <div class=\"p-tree-empty-message\" *ngIf=\"!loading && (value == null || value.length === 0)\">{{emptyMessage}}</div>\n        </div>\n        <div [ngClass]=\"{'p-tree p-tree-horizontal p-component':true,'p-tree-selectable':selectionMode}\"  [ngStyle]=\"style\" [class]=\"styleClass\" *ngIf=\"horizontal\">\n            <div class=\"p-tree-loading-mask p-component-overlay\" *ngIf=\"loading\">\n                <i [class]=\"'p-tree-loading-icon pi-spin ' + loadingIcon\"></i>\n            </div>\n            <table *ngIf=\"value&&value[0]\">\n                <p-treeNode [node]=\"value[0]\" [root]=\"true\"></p-treeNode>\n            </table>\n            <div class=\"p-tree-empty-message\" *ngIf=\"!loading && (value == null || value.length === 0)\">{{emptyMessage}}</div>\n        </div>\n    `,\n    changeDetection: ChangeDetectionStrategy.Default,\n    encapsulation: ViewEncapsulation.None,\n    styleUrls: ['./tree.css']\n})\nexport class Tree implements OnInit,AfterContentInit,OnChanges,OnDestroy,BlockableUI {\n\n    @Input() value: TreeNode[];\n\n    @Input() selectionMode: string;\n\n    @Input() selection: any;\n\n    @Output() selectionChange: EventEmitter<any> = new EventEmitter();\n\n    @Output() onNodeSelect: EventEmitter<any> = new EventEmitter();\n\n    @Output() onNodeUnselect: EventEmitter<any> = new EventEmitter();\n\n    @Output() onNodeExpand: EventEmitter<any> = new EventEmitter();\n\n    @Output() onNodeCollapse: EventEmitter<any> = new EventEmitter();\n\n    @Output() onNodeContextMenuSelect: EventEmitter<any> = new EventEmitter();\n\n    @Output() onNodeDrop: EventEmitter<any> = new EventEmitter();\n\n    @Input() style: any;\n\n    @Input() styleClass: string;\n\n    @Input() contextMenu: any;\n\n    @Input() layout: string = 'vertical';\n\n    @Input() draggableScope: any;\n\n    @Input() droppableScope: any;\n\n    @Input() draggableNodes: boolean;\n\n    @Input() droppableNodes: boolean;\n\n    @Input() metaKeySelection: boolean = true;\n\n    @Input() propagateSelectionUp: boolean = true;\n\n    @Input() propagateSelectionDown: boolean = true;\n\n    @Input() loading: boolean;\n\n    @Input() loadingIcon: string = 'pi pi-spinner';\n\n    @Input() emptyMessage: string = 'No records found';\n\n    @Input() ariaLabel: string;\n\n    @Input() ariaLabelledBy: string;\n\n    @Input() validateDrop: boolean;\n\n    @Input() filter: boolean;\n\n    @Input() filterBy: string = 'label';\n\n    @Input() filterMode: string = 'lenient';\n\n    @Input() filterPlaceholder: string;\n\n    @Input() filterLocale: string;\n\n    @Input() scrollHeight: string;\n\n    @Input() virtualScroll: boolean;\n\n    @Input() virtualNodeHeight: string;\n\n    @Input() minBufferPx: number;\n\n    @Input() maxBufferPx: number;\n\n    @Input() trackBy: Function = (index: number, item: any) => item;\n\n    @Output() onFilter: EventEmitter<any> = new EventEmitter();\n\n    @ContentChildren(PrimeTemplate) templates: QueryList<any>;\n\n    serializedValue: any[];\n\n    public templateMap: any;\n\n    public nodeTouched: boolean;\n\n    public dragNodeTree: Tree;\n\n    public dragNode: TreeNode;\n\n    public dragNodeSubNodes: TreeNode[];\n\n    public dragNodeIndex: number;\n\n    public dragNodeScope: any;\n\n    public dragHover: boolean;\n\n    public dragStartSubscription: Subscription;\n\n    public dragStopSubscription: Subscription;\n\n    public filteredNodes: TreeNode[];\n\n    constructor(public el: ElementRef, @Optional() public dragDropService: TreeDragDropService) {}\n\n    ngOnInit() {\n        if (this.droppableNodes) {\n            this.dragStartSubscription = this.dragDropService.dragStart$.subscribe(\n              event => {\n                this.dragNodeTree = event.tree;\n                this.dragNode = event.node;\n                this.dragNodeSubNodes = event.subNodes;\n                this.dragNodeIndex = event.index;\n                this.dragNodeScope = event.scope;\n            });\n\n            this.dragStopSubscription = this.dragDropService.dragStop$.subscribe(\n              event => {\n                this.dragNodeTree = null;\n                this.dragNode = null;\n                this.dragNodeSubNodes = null;\n                this.dragNodeIndex = null;\n                this.dragNodeScope = null;\n                this.dragHover = false;\n            });\n        }\n    }\n\n    ngOnChanges(simpleChange: SimpleChanges) {\n        if (simpleChange.value) {\n            this.updateSerializedValue();\n        }\n    }\n\n    get horizontal(): boolean {\n        return this.layout == 'horizontal';\n    }\n\n    ngAfterContentInit() {\n        if (this.templates.length) {\n            this.templateMap = {};\n        }\n\n        this.templates.forEach((item) => {\n            this.templateMap[item.name] = item.template;\n        });\n    }\n\n    updateSerializedValue() {\n        this.serializedValue = [];\n        this.serializeNodes(null, this.getRootNode(), 0, true);\n    }\n\n    serializeNodes(parent, nodes, level, visible) {\n        if (nodes && nodes.length) {\n            for(let node of nodes) {\n                node.parent = parent;\n                const rowNode = {\n                    node: node,\n                    parent: parent,\n                    level: level,\n                    visible: visible && (parent ? parent.expanded : true)\n                };\n                this.serializedValue.push(rowNode);\n\n                if (rowNode.visible && node.expanded) {\n                    this.serializeNodes(node, node.children, level + 1, rowNode.visible);\n                }\n            }\n        }\n    }\n\n    onNodeClick(event, node: TreeNode) {\n        let eventTarget = (<Element> event.target);\n\n        if (DomHandler.hasClass(eventTarget, 'p-tree-toggler') || DomHandler.hasClass(eventTarget, 'p-tree-toggler-icon')) {\n            return;\n        }\n        else if (this.selectionMode) {\n            if (node.selectable === false) {\n                return;\n            }\n\n            if (this.hasFilteredNodes()) {\n                node = this.getNodeWithKey(node.key, this.value);\n\n                if (!node) {\n                    return;\n                }\n            }\n\n            let index = this.findIndexInSelection(node);\n            let selected = (index >= 0);\n\n            if (this.isCheckboxSelectionMode()) {\n                if (selected) {\n                    if (this.propagateSelectionDown)\n                        this.propagateDown(node, false);\n                    else\n                        this.selection = this.selection.filter((val,i) => i!=index);\n\n                    if (this.propagateSelectionUp && node.parent) {\n                        this.propagateUp(node.parent, false);\n                    }\n\n                    this.selectionChange.emit(this.selection);\n                    this.onNodeUnselect.emit({originalEvent: event, node: node});\n                }\n                else {\n                    if (this.propagateSelectionDown)\n                        this.propagateDown(node, true);\n                    else\n                        this.selection = [...this.selection||[],node];\n\n                    if (this.propagateSelectionUp && node.parent) {\n                        this.propagateUp(node.parent, true);\n                    }\n\n                    this.selectionChange.emit(this.selection);\n                    this.onNodeSelect.emit({originalEvent: event, node: node});\n                }\n            }\n            else {\n                let metaSelection = this.nodeTouched ? false : this.metaKeySelection;\n\n                if (metaSelection) {\n                    let metaKey = (event.metaKey||event.ctrlKey);\n\n                    if (selected && metaKey) {\n                        if (this.isSingleSelectionMode()) {\n                            this.selectionChange.emit(null);\n                        }\n                        else {\n                            this.selection = this.selection.filter((val,i) => i!=index);\n                            this.selectionChange.emit(this.selection);\n                        }\n\n                        this.onNodeUnselect.emit({originalEvent: event, node: node});\n                    }\n                    else {\n                        if (this.isSingleSelectionMode()) {\n                            this.selectionChange.emit(node);\n                        }\n                        else if (this.isMultipleSelectionMode()) {\n                            this.selection = (!metaKey) ? [] : this.selection||[];\n                            this.selection = [...this.selection,node];\n                            this.selectionChange.emit(this.selection);\n                        }\n\n                        this.onNodeSelect.emit({originalEvent: event, node: node});\n                    }\n                }\n                else {\n                    if (this.isSingleSelectionMode()) {\n                        if (selected) {\n                            this.selection = null;\n                            this.onNodeUnselect.emit({originalEvent: event, node: node});\n                        }\n                        else {\n                            this.selection = node;\n                            this.onNodeSelect.emit({originalEvent: event, node: node});\n                        }\n                    }\n                    else {\n                        if (selected) {\n                            this.selection = this.selection.filter((val,i) => i!=index);\n                            this.onNodeUnselect.emit({originalEvent: event, node: node});\n                        }\n                        else {\n                            this.selection = [...this.selection||[],node];\n                            this.onNodeSelect.emit({originalEvent: event, node: node});\n                        }\n                    }\n\n                    this.selectionChange.emit(this.selection);\n                }\n            }\n        }\n\n        this.nodeTouched = false;\n    }\n\n    onNodeTouchEnd() {\n        this.nodeTouched = true;\n    }\n\n    onNodeRightClick(event: MouseEvent, node: TreeNode) {\n        if (this.contextMenu) {\n            let eventTarget = (<Element> event.target);\n\n            if (eventTarget.className && eventTarget.className.indexOf('p-tree-toggler') === 0) {\n                return;\n            }\n            else {\n                let index = this.findIndexInSelection(node);\n                let selected = (index >= 0);\n\n                if (!selected) {\n                    if (this.isSingleSelectionMode())\n                        this.selectionChange.emit(node);\n                    else\n                        this.selectionChange.emit([node]);\n                }\n\n                this.contextMenu.show(event);\n                this.onNodeContextMenuSelect.emit({originalEvent: event, node: node});\n            }\n        }\n    }\n\n    findIndexInSelection(node: TreeNode) {\n        let index: number = -1;\n\n        if (this.selectionMode && this.selection) {\n            if (this.isSingleSelectionMode()) {\n                let areNodesEqual = (this.selection.key && this.selection.key === node.key) || this.selection == node;\n                index = areNodesEqual ? 0 : - 1;\n            }\n            else {\n                for(let i = 0; i  < this.selection.length; i++) {\n                    let selectedNode = this.selection[i];\n                    let areNodesEqual = (selectedNode.key && selectedNode.key === node.key) || selectedNode == node;\n                    if (areNodesEqual) {\n                        index = i;\n                        break;\n                    }\n                }\n            }\n        }\n\n        return index;\n    }\n\n    syncNodeOption(node, parentNodes, option, value?: any) {\n        // to synchronize the node option between the filtered nodes and the original nodes(this.value)\n        const _node = this.hasFilteredNodes() ? this.getNodeWithKey(node.key, parentNodes) : null;\n        if (_node) {\n            _node[option] = value||node[option];\n        }\n    }\n\n    hasFilteredNodes() {\n        return this.filter && this.filteredNodes && this.filteredNodes.length;\n    }\n\n    getNodeWithKey(key: string, nodes: TreeNode[]) {\n        for (let node of nodes) {\n            if (node.key === key) {\n                return node;\n            }\n\n            if (node.children) {\n                let matchedNode = this.getNodeWithKey(key, node.children);\n                if (matchedNode) {\n                    return matchedNode;\n                }\n            }\n        }\n    }\n\n    propagateUp(node: TreeNode, select: boolean) {\n        if (node.children && node.children.length) {\n            let selectedCount: number = 0;\n            let childPartialSelected: boolean = false;\n            for(let child of node.children) {\n                if (this.isSelected(child)) {\n                    selectedCount++;\n                }\n                else if (child.partialSelected) {\n                    childPartialSelected = true;\n                }\n            }\n\n            if (select && selectedCount == node.children.length) {\n                this.selection = [...this.selection||[],node];\n                node.partialSelected = false;\n            }\n            else {\n                if (!select) {\n                    let index = this.findIndexInSelection(node);\n                    if (index >= 0) {\n                        this.selection = this.selection.filter((val,i) => i!=index);\n                    }\n                }\n\n                if (childPartialSelected || selectedCount > 0 && selectedCount != node.children.length)\n                    node.partialSelected = true;\n                else\n                    node.partialSelected = false;\n            }\n\n            this.syncNodeOption(node, this.filteredNodes, 'partialSelected');\n        }\n\n        let parent = node.parent;\n        if (parent) {\n            this.propagateUp(parent, select);\n        }\n    }\n\n    propagateDown(node: TreeNode, select: boolean) {\n        let index = this.findIndexInSelection(node);\n\n        if (select && index == -1) {\n            this.selection = [...this.selection||[],node];\n        }\n        else if (!select && index > -1) {\n            this.selection = this.selection.filter((val,i) => i!=index);\n        }\n\n        node.partialSelected = false;\n\n        this.syncNodeOption(node, this.filteredNodes, 'partialSelected');\n\n        if (node.children && node.children.length) {\n            for(let child of node.children) {\n                this.propagateDown(child, select);\n            }\n        }\n    }\n\n    isSelected(node: TreeNode) {\n        return this.findIndexInSelection(node) != -1;\n    }\n\n    isSingleSelectionMode() {\n        return this.selectionMode && this.selectionMode == 'single';\n    }\n\n    isMultipleSelectionMode() {\n        return this.selectionMode && this.selectionMode == 'multiple';\n    }\n\n    isCheckboxSelectionMode() {\n        return this.selectionMode && this.selectionMode == 'checkbox';\n    }\n\n    isNodeLeaf(node) {\n        return node.leaf == false ? false : !(node.children && node.children.length);\n    }\n\n    getRootNode() {\n        return this.filteredNodes ? this.filteredNodes : this.value;\n    }\n\n    getTemplateForNode(node: TreeNode): TemplateRef<any> {\n        if (this.templateMap)\n            return node.type ? this.templateMap[node.type] : this.templateMap['default'];\n        else\n            return null;\n    }\n\n    onDragOver(event) {\n        if (this.droppableNodes && (!this.value || this.value.length === 0)) {\n            event.dataTransfer.dropEffect = 'move';\n            event.preventDefault();\n        }\n    }\n\n    onDrop(event) {\n        if (this.droppableNodes && (!this.value || this.value.length === 0)) {\n            event.preventDefault();\n            let dragNode = this.dragNode;\n            if(this.allowDrop(dragNode, null, this.dragNodeScope, DropType.Both)) {\n                let dragNodeIndex = this.dragNodeIndex;\n                this.dragNodeSubNodes.splice(dragNodeIndex, 1);\n                this.value = this.value||[];\n                this.value.push(dragNode);\n\n                this.dragDropService.stopDrag({\n                    node: dragNode\n                });\n            }\n        }\n    }\n\n    onDragEnter(event) {\n        if (this.droppableNodes && this.allowDrop(this.dragNode, null, this.dragNodeScope, DropType.Both)) {\n            this.dragHover = true;\n        }\n    }\n\n    onDragLeave(event) {\n        if (this.droppableNodes) {\n            let rect = event.currentTarget.getBoundingClientRect();\n            if (event.x > rect.left + rect.width || event.x < rect.left || event.y > rect.top + rect.height || event.y < rect.top) {\n               this.dragHover = false;\n            }\n        }\n    }\n\n    allowDrop(dragNode: TreeNode, dropNode: TreeNode, dragNodeScope: any, dropType: DropType): boolean {\n        if(!dragNode) {\n            //prevent random html elements to be dragged\n            return false;\n        }\n        else if (this.isValidDragScope(dragNodeScope)) {\n            let allow: boolean = true;\n            if (dropNode) {\n                if (dragNode === dropNode) {\n                    allow = false;\n                }\n                else {\n                    let parent = dropNode.parent;\n                    while(parent != null) {\n                        if (parent === dragNode) {\n                            allow = false;\n                            break;\n                        }\n                        parent = parent.parent;\n                    }\n\n                    if (allow) {\n                        const evaluateDropScope = (dropScope: any, dragScope: any) => {\n                            if (typeof dropScope === 'string') {\n                                if (typeof dragScope === 'string')\n                                    allow = dropScope === dragScope;\n                                else if (dragScope instanceof Array)\n                                    allow = (<Array<any>>dragScope).indexOf(dropScope) != -1;\n                            }\n                            else if (dropScope instanceof Array) {\n                                if (typeof dragScope === 'string') {\n                                    allow = (<Array<any>>dropScope).indexOf(dragScope) != -1;\n                                }\n                                else if (dragScope instanceof Array) {\n                                    for (let s of dropScope) {\n                                        for (let ds of dragScope) {\n                                            if (s === ds) {\n                                                allow = true;\n                                                break;\n                                            }\n                                        }\n                                    }\n                                }\n                            }\n                        };\n\n                        if (dropType === DropType.Node) {\n                            evaluateDropScope(dropNode.dropScope, dragNode.dragScope);\n                        } else if (dropType === DropType.DropPoint) {\n                            evaluateDropScope(dropNode.dropPointScope, dragNode.dragScope);\n                        } else if (dropType === DropType.Both) {\n                            evaluateDropScope(dropNode.dropScope, dragNode.dragScope);\n                            evaluateDropScope(dropNode.dropPointScope, dragNode.dragScope);\n                        }\n                    }\n                }\n            }\n\n            return allow;\n        }\n        else {\n            return false;\n        }\n    }\n\n    isValidDragScope(dragScope: any): boolean {\n        let dropScope = this.droppableScope;\n\n        if (dropScope) {\n            if (typeof dropScope === 'string') {\n                if (typeof dragScope === 'string')\n                    return dropScope === dragScope;\n                else if (dragScope instanceof Array)\n                    return (<Array<any>>dragScope).indexOf(dropScope) != -1;\n            }\n            else if (dropScope instanceof Array) {\n                if (typeof dragScope === 'string') {\n                    return (<Array<any>>dropScope).indexOf(dragScope) != -1;\n                }\n                else if (dragScope instanceof Array) {\n                    for(let s of dropScope) {\n                        for(let ds of dragScope) {\n                            if (s === ds) {\n                                return true;\n                            }\n                        }\n                    }\n                }\n            }\n            return false;\n        }\n        else {\n            return true;\n        }\n    }\n\n    _filter(event) {\n        let filterValue = event.target.value;\n        if (filterValue === '') {\n            this.filteredNodes = null;\n        }\n        else {\n            this.filteredNodes = [];\n            const searchFields: string[] = this.filterBy.split(',');\n            const filterText = ObjectUtils.removeAccents(filterValue).toLocaleLowerCase(this.filterLocale);\n            const isStrictMode = this.filterMode === 'strict';\n            for(let node of this.value) {\n                let copyNode = {...node};\n                let paramsWithoutNode = {searchFields, filterText, isStrictMode};\n                if ((isStrictMode && (this.findFilteredNodes(copyNode, paramsWithoutNode) || this.isFilterMatched(copyNode, paramsWithoutNode))) ||\n                    (!isStrictMode && (this.isFilterMatched(copyNode, paramsWithoutNode) || this.findFilteredNodes(copyNode, paramsWithoutNode)))) {\n                    this.filteredNodes.push(copyNode);\n                }\n            }\n        }\n\n        this.updateSerializedValue();\n        this.onFilter.emit({\n            filter: filterValue,\n            filteredValue: this.filteredNodes\n        });\n    }\n\n    findFilteredNodes(node, paramsWithoutNode) {\n        if (node) {\n            let matched = false;\n            if (node.children) {\n                let childNodes = [...node.children];\n                node.children = [];\n                for (let childNode of childNodes) {\n                    let copyChildNode = {...childNode};\n                    if (this.isFilterMatched(copyChildNode, paramsWithoutNode)) {\n                        matched = true;\n                        node.children.push(copyChildNode);\n                    }\n                }\n            }\n\n            if (matched) {\n                node.expanded = true;\n                return true;\n            }\n        }\n    }\n\n    isFilterMatched(node, {searchFields, filterText, isStrictMode}) {\n        let matched = false;\n        for(let field of searchFields) {\n            let fieldValue = ObjectUtils.removeAccents(String(ObjectUtils.resolveFieldData(node, field))).toLocaleLowerCase(this.filterLocale);\n            if (fieldValue.indexOf(filterText) > -1) {\n                matched = true;\n            }\n        }\n\n        if (!matched || (isStrictMode && !this.isNodeLeaf(node))) {\n            matched = this.findFilteredNodes(node, {searchFields, filterText, isStrictMode}) || matched;\n        }\n\n        return matched;\n    }\n\n    getBlockableElement(): HTMLElement{\n      return this.el.nativeElement.children[0];\n    }\n\n    ngOnDestroy() {\n        if (this.dragStartSubscription) {\n            this.dragStartSubscription.unsubscribe();\n        }\n\n        if (this.dragStopSubscription) {\n            this.dragStopSubscription.unsubscribe();\n        }\n    }\n}\nexport enum DropType {\n    Both,\n    DropPoint,\n    Node\n}\n@NgModule({\n    imports: [CommonModule,ScrollingModule,RippleModule],\n    exports: [Tree,SharedModule,ScrollingModule],\n    declarations: [Tree,UITreeNode]\n})\nexport class TreeModule { }\n"]}